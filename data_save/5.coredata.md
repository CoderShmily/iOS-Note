# CoreData

Core Data框架提供了对象-关系映射(ORM)的功能,即能够将OC对象转化成数据,保存在SQLite3数据库文件中,也能将保存在数据库中的数据还原成OC对象.在次数据操作期间,不需要编写任何SQL语句.

```
使用此功能,要添加CoreData.framework和导入主头文件<CoreDate/CoreData.h>.
```
模型文件:
在CoreData中,需要进行映射的对象称为实体(entity),而且需要使用CoreData的模型文件来描述应用的所有实体和实体属性.

#### NSManagedObject
```objc
通过Core Data从数据库中取出的对象,默认情况下都是NSManagedObject对象.

NSManagedObject的工作模式有点类似于NSDictionary对象,通过键-值对来存取所有的实体属性.

setValue:forkey:存储属性值(属性名为key);

valueForKey:获取属性值(属性名为key).
```

#### CoreData主要对象
```objc
NSManagedObjectContext:负责数据和应用库之间的交互(CRUD);

NSPersistentStoreCoordinator:添加持久化存储库(比如SQLite数据库);

NSManagedObjectModel:代表Core Data的模型文件;

NSEntityDescription：用来描述实体;
```

#### 搭建CoreData上下文环境:
```objc
// 从应用程序包中加载模型文件 
NSManagedObjectModel *model = [NSManagedObjectModel mergedModelFromBundles:nil];
// 传入模型，初始化NSPersistentStoreCoordinator 
NSPersistentStoreCoordinator *psc = [[NSPersistentStoreCoordinator alloc] initWithManagedObjectModel:model];
// 构建SQLite文件路径 
NSString *docs = [NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) 
 lastObject];
NSURL *url = [NSURL fileURLWithPath:[docs stringByAppendingPathComponent:@"person.data"]];
// 添加持久化存储库，这里使用SQLite作为存储库 
NSError *error = nil;
NSPersistentStore *store = [psc addPersistentStoreWithType:NSSQLiteStoreType configuration:nil URL:url options:nil error:&error];
if (store == nil) { // 直接抛异常
    [NSException raise:@"添加数据库错误" format:@"%@", [error localizedDescription]];
}
// 初始化上下文，设置persistentStoreCoordinator属性 
NSManagedObjectContext *context = [[NSManagedObjectContext alloc] init];
context.persistentStoreCoordinator = psc;
// 用完之后，还是要[context release];
/*
持久化存储库的类型：
NSSQLiteStoreType  SQLite数据库 
NSBinaryStoreType  二进制平面文件 
NSInMemoryStoreType 内存库，无法永久保存数据 
虽然这3种类型的性能从速度上来说都差不多，但从数据模型中保留下来的信息却不一样
在几乎所有的情景中，都应该采用默认设置，使用SQLite作为持久化存储库
*/
```